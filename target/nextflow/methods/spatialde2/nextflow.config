manifest {
  name = 'methods/spatialde2'
  mainScript = 'main.nf'
  nextflowVersion = '!>=20.12.1-edge'
  version = '1.0.0'
  description = 'Spatial transcriptomics is now a mature technology, allowing to assay gene expression changes \nin the histological context of complex tissues. A canonical analysis workflow starts with the \nidentification of tissue zones that share similar expression profiles, followed by the detection \nof highly variable or spatially variable genes. Rapid increases in the scale and complexity of \nspatial transcriptomic datasets demand that these analysis steps are conducted in a consistent \nand integrated manner, a requirement that is not met by current methods. To address this, we \nhere present SpatialDE2, which unifies the mapping of tissue zones and spatial variable gene \ndetection as integrated software framework, while at the same time advancing current algorithms \nfor both of these steps. Formulated in a Bayesian framework, the model accounts for the Poisson \ncount noise, while simultaneously offering superior computational speed compared to previous methods. \nWe validate SpatialDE2 using simulated data and illustrate its utility in the context of two real-world \napplications to the spatial transcriptomics profiles of the mouse brain and human endometrium.\n'
}

process.container = 'nextflow/bash:latest'

// detect tempdir
tempDir = java.nio.file.Paths.get(
  System.getenv('NXF_TEMP') ?:
    System.getenv('VIASH_TEMP') ?: 
    System.getenv('TEMPDIR') ?: 
    System.getenv('TMPDIR') ?: 
    '/tmp'
).toAbsolutePath()

profiles {
  no_publish {
    process {
      withName: '.*' {
        publishDir = [
          enabled: false
        ]
      }
    }
  }
  mount_temp {
    docker.temp            = tempDir
    podman.temp            = tempDir
    charliecloud.temp      = tempDir
  }
  docker {
    docker.enabled         = true
    // docker.userEmulation   = true
    singularity.enabled    = false
    podman.enabled         = false
    shifter.enabled        = false
    charliecloud.enabled   = false
  }
  singularity {
    singularity.enabled    = true
    singularity.autoMounts = true
    docker.enabled         = false
    podman.enabled         = false
    shifter.enabled        = false
    charliecloud.enabled   = false
  }
  podman {
    podman.enabled         = true
    docker.enabled         = false
    singularity.enabled    = false
    shifter.enabled        = false
    charliecloud.enabled   = false
  }
  shifter {
    shifter.enabled        = true
    docker.enabled         = false
    singularity.enabled    = false
    podman.enabled         = false
    charliecloud.enabled   = false
  }
  charliecloud {
    charliecloud.enabled   = true
    docker.enabled         = false
    singularity.enabled    = false
    podman.enabled         = false
    shifter.enabled        = false
  }
}

process{
  withLabel: lowmem { memory = 20.Gb }
  withLabel: midmem { memory = 50.Gb }
  withLabel: highmem { memory = 100.Gb }
  withLabel: lowcpu { cpus = 5 }
  withLabel: midcpu { cpus = 15 }
  withLabel: highcpu { cpus = 30 }
  withLabel: lowtime { time = 1.h }
  withLabel: midtime { time = 4.h }
  withLabel: hightime { time = 8.h }
  withLabel: veryhightime { time = 24.h }
}

process.errorStrategy = 'ignore'
